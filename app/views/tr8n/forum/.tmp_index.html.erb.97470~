<%= render :partial => "/tr8n/common/header" %>

<% unless @topics.empty? %>
<div class="section_title">
  <div style="float:right; padding-top:6px; font-size:12px; color: #ccc;">
    <%=image_tag('tr8n/plus.png')%> <%= link_to(trl("Start a new discussion topic"), :action => :topic, :mode => :create) %>
  </div>
  
  <%=trl("#{tr8n_current_language.english_name} Language Discussion Topics") %>  
</div>
<div class="section_box">
    <table style="width:100%;">
       <tr style="border-bottom: 1px solid #ccc;">
         <td class="topic_header" style="width:20%"><%=trl("Author")%></td>
         <td class="topic_header" style="width:50%"><%=trl("Topic")%></td>
         <td class="topic_header" style="width:10%"><%=trl("Posts")%></td>
         <td class="topic_header" style="width:20%"><%=trl("Last Post")%></td>
       </tr> 
      <% @topics.each do |topic| %>
        <%
          style = (topic == @topics.last ? "" : "border-bottom:1px dotted #ccc;" )
        %>  
        <tr style="<%=style%>">
          <td class="topic_value">
            <table>
              <tr>
                <td style="vertical-align:top;padding-right:5px;">
                  <%=tr8n_user_mugshot_tag(topic.translator, :linked => true)%>
                </td>
                <td style="vertical-align:top">
                  <%=tr8n_user_tag(topic.translator, :linked => true)%>
                  <div style="color:grey;">
                      <%=tr8n_current_language.localize_date(topic.created_at, :date_time, {:skip_decorations => true}) %>
                  </div>
                  <div style="font-size:10px;">
                    <% if tr8n_current_user_is_translator? and topic.translator == tr8n_current_translator %>  
                        <%=link_to(trl("Delete"), {:action => :delete_topic, :topic_id => topic.id}, 
                          {:confirm => trl("Are you sure you want to delete this topic and all of the messages under it?", "", {}, {:skip_decorations => true})})%>
                    <% end %>
                  </div>
                </td>
              </tr>
            </table>
          </td>
          <td class="topic_value">
            <%=link_to(topic.topic, :action => :topic, :topic_id => topic.id)%><br>
          </td>    
          <td class="topic_value">
            <%=topic.post_count %>
          </td>
          <td class="topic_value">
            <% if topic.last_post %>
               <div style="font-size:10px;"><%=tr8n_current_language.localize_date(topic.last_post.created_at, :date_time, {:skip_decorations => true}) %> 
                <%=trl("by {user}", "Name of the publisher", :user => [topic.translator.user, tr8n_user_tag(topic.translator, :linked => true)])%>
               </div> 
               <% 
                  message = topic.last_post.message[0..60]
                  message << "..." if topic.last_post.message.length > 60 
               %> 
               <div style="font-style:italic; font-size:10px">"<%=link_to(h(message), :action => :topic, :topic_id =>topic.id, :last_page => true)%>"</div>
            <% end %>
            &nbsp;
          </td>
        </tr>
      <% end %>
    </table>
  
    <div style="margin-bottom:5px; padding-top:5px; border-top: 1px solid #ccc;">
      <table style="width:100%;">
        <tr>
          <td align='left'><%= page_entries_info(@topics, :entry_name => "forum topic", :skip_decorations => true) %></td>
          <td align='right'><%= will_paginate(@topics, :skip_decorations => true) %></td>
        </tr>
      </table>
    </div>
</div>
<% end %>

<%= render :partial => "new_topic", :locals => {:include_cancel_button => false} %>
<%= render :partial => "/tr8n/common/footer" %>
