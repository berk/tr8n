<div id="translation_tokens" style="padding-top:10px; padding-bottom:5px; font-size:10px;">
  <div class="section_title">
  	 <%=trl("Translation Tokens and Dependencies")%>
	</div>
  
  <% if @translation_key.sanitized_tokens? %>
	    <% @translation_key.sanitized_tokens.each do |token| %>
          <%= link_to_function(token, "tr8nTranslator.insertAtCaret('tr8n_translation_label_#{@translation_key.id}', '#{token}');", :title => trl("Tip: Click to insert this token above")) %> 
      <% end %>
			
      <div style="color:grey; font-size:10px; padding-top:10px; padding-bottom:10px;">
			   <%=trl("Click on a token to insert it into the label")%>
			</div>
  <% end %>

  <% if tr8n_current_language.has_rules? %>
	  <div id="rules_trigger" style="font-size:10px; font-weight:bold;">
		  <% 
         if @translation_key.sanitized_tokens? 
			     link_label = trl("Click here if this translation depends on any of the token values or the gender of the viewing user")
         else
           link_label = trl("Click here if this translation depends on the gender of the viewing user")
         end 
      %>
      <%=link_to_function(link_label, "$('has_rules').value='true'; $('rules_trigger').hide(); Effect.BlindDown('translation_rules', { duration: 0.2 });") %>
	  </div>
		
    <div id="translation_rules" style="padding:5px; border: 1px dotted #ccc; background:#EFF8FF; display:none;">
      <div style="font-size:14px; font-weight:normal;">
			   <%=trl("Token Dependency Rules")%>
			</div>
      
      <%=hidden_field_tag("has_rules", "true") %>

			<div style="padding-top:10px;padding-bottom:5px;">
					<table style="border:1px; width:auto;">
					  <tr style="border-bottom:1px dotted #ccc;">
					    <td style=""></td>
					    <td style="font-size:10px; font-weight:bold; padding:5px;">Token</td>
					    <td style="font-size:10px; font-weight:bold; padding:5px;">Rule Options</td>        
					  </tr>
					
						<% @translation_key.language_rules_dependant_tokens.each_with_index do |token, index| %>
						  <% 
		            rule_options = []
		            tr8n_current_language.rule_classes.each do |rule_class| 
			            if rule_class.dependant?(token)
			               rule_options += rule_class.for(tr8n_current_language).collect{|rule| [rule.description, rule.id.to_s]}
			            end  
		            end 
		          %>
						  <tr>
						    <td style="padding:3px; vertical-align:middle;">
						      <%=check_box_tag("rules[#{token}][selected]", "true", (@rules[token]!=nil), :id => "check_#{index}")%>     
						    </td>
						    <td style="font-size:10px; padding:3px; vertical-align:middle;">
						      <%=token %>     
						    </td>
						    <td style="font-size:10px; padding:5px; vertical-align:middle;">
						      <%=select_tag("rules[#{token}][rule_id]", options_for_select(rule_options, @rules[token].to_s), :onChange => "$('check_#{index}').checked = true;")%>      
						    </td>
						  </tr>
						<% end %>
					</table>
		  </div>
				
			<div style="color:grey; font-size:10px; padding-top:10px;"><%=trl("Select all rules that apply to this translation")%></div>
			
			<div style="padding-top:10px;font-size:10px; font-weight:bold;">
        <%=link_to_function(trl("Click here if the translation does not depend on the token values."), "$('has_rules').value='false'; $('rules_trigger').show(); Effect.BlindUp('translation_rules', { duration: 0.2 });") %>
			</div>
    </div>
  <% end %>
  
</div>