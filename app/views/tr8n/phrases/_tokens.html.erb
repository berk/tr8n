<% if @translation_key.tokens? or @translation_key.permutatable? %>

<div id="translation_tokens" style="padding-bottom:5px; font-size:12px;">
  <div class="section_title">
  	 <%=trl("Translation Tokens")%>
	</div>
  
	
  <% if @translation_key.translation_tokens? %>
      <% @translation_key.translation_tokens.each do |token| %>
        <% if token.is_a?(Tr8n::DecorationToken) %>
          <%= link_to_function(token.sanitized_name, "tr8nTranslator.insertDecorationToken('#{token.name}', 'tr8n_translation_label_#{@translation_key.id}');", :title => trl("Click to insert this token above") ) %>
        <% else %>
          <%= link_to_function(token.sanitized_name, "tr8nTranslator.insertToken('#{token.name}', 'tr8n_translation_label_#{@translation_key.id}');", :title => trl("Click to insert this token above") ) %>
        <% end %>
      <% end %>
			
      <div style="color:grey; font-size:12px; padding-top:10px; padding-bottom:10px;">
			   <%=trl("Click on a token to insert it into the label")%>
			</div>
  <% end %>

  <% if @translation_key.permutatable? %>
    <div id="rules_trigger" style="font-size:12px; font-weight:normal;">
      <% 
         if @translation_key.translation_tokens? 
           link_label = tra("Click here if this translation depends on any of the token values or the gender of the viewing user")
         else
           link_label = tra("Click here if this translation depends on the gender of the viewing user")
         end 
      %>
      <%=link_to_function(link_label, "Tr8n.element('has_rules').value='true'; Tr8n.hide('rules_trigger'); Tr8n.blindDown('translation_rules');") %>
    </div>
		
    <div id="translation_rules" style="padding:5px; border: 1px dotted #ccc; background:#EFF8FF; display:none;">
      <div style="font-size:14px; font-weight:normal; border-bottom: 1px dotted #ccc;">
			   <%=trl("Token Dependency Rules For This Translation")%>
			</div>
      
      <%=hidden_field_tag("has_rules", "true") %>

			<div style="padding-top:10px;padding-bottom:5px;">
					<table style="border:1px; width:auto;">
					  <tr style="border-bottom:1px dotted #ccc;">
					    <td style=""></td>
					    <td style="font-size:10px; font-weight:bold; padding:5px;"><%=trl('Token', 'Tr8n translation rules header')%></td>
					    <td style="font-size:10px; font-weight:bold; padding:5px;"><%=trl('Context Rule', 'Tr8n translation rules header')%></td>        
					  </tr>
					
						<% @translation_key.language_rules_dependant_tokens.each_with_index do |token, index| %>
						  <% 
		            rule_options = []
		            tr8n_current_language.rule_classes.each do |rule_class| 
			            if rule_class.dependant?(token)
			               rule_options += rule_class.for(tr8n_current_language).collect{|rule| [rule.description, rule.id.to_s]}
			            end  
		            end 
		          %>
						  <tr>
						    <td style="padding:3px; vertical-align:middle;">
						      <%=check_box_tag("rules[#{token.name}][selected]", "true", (@rules[token.name]!=nil), :id => "check_#{index}", :style => "width:20px")%>     
						    </td>
						    <td style="font-size:10px; padding:3px; vertical-align:middle;">
						      <%=token.name %>     
						    </td>
						    <td style="font-size:10px; padding:5px; vertical-align:middle;">
						      <%=select_tag("rules[#{token.name}][rule_id]", options_for_select(rule_options, @rules[token].to_s), :onChange => "Tr8n.element('check_#{index}').checked = true;")%>      
						    </td>
						  </tr>
						<% end %>
					</table>
		  </div>
				
			<div style="color:grey; font-size:12px; padding-top:10px;"><%=trl("Select all of the rules that apply to this translation or [link: generate all context rules for this phrase].", '', :link => lambda{|t| link_to_function(t, 'addContextRules()')})%></div>
			
			<div style="padding-top:10px;font-size:12px; font-weight:normal;">
        <%=link_to_function(trl("&laquo; this translation has no context rules", 'Tr8n translation rules section'), "Tr8n.element('has_rules').value='false'; Tr8n.show('rules_trigger'); Tr8n.blindUp('translation_rules');") %>
			</div>
    </div>
  <% end %>
  
</div>
<% end %>